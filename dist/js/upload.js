/*
Change by PengWu on 2017-07-06 19:21:36
*/
svp.define("upload",function(require,exports,module){"use strict";var $=svp.$,s=require("base/vars"),e=s.VSTAR_PXY_URL,a={600:"上传失败! fileInput参数错误",601:"上传失败! 上传内容不符合要求！",602:"上传失败! 图片格式不符合要求！",603:"上传失败! 服务器错误！",604:"上传失败! 用户数据错误！"};/t\.m\.tv\.sohu\.com|my\.test\.sohu\.com/i.test(window.location.host)&&(e="//t.m.tv.sohu.com/pxy1/");var t={urls:{uploadImg:"star/h5/topic/uploadPic.json"}},o={uploadImageByAjax:function(s,a,o){$.ajax({url:(o?"//fans.tv.sohu.com/":e)+t.urls.uploadImg,data:s,type:"post",success:a,error:a})},uploadImageProcess:function(s){var e={result:!1,msg:"上传失败",img:"",type:"img"};return void 0===s||200!==s.status||$.isUndefined(s.message)?void 0!==s&&10010===s.status?e.msg="不支持的图片类型":void 0!==s&&10011===s.status?e.msg="无效的图片":void 0!==s&&10012===s.status&&(e.msg="不支持的附件类型"):e={result:!0,msg:"上传成功",img:s.message.picUrl,type:"img"},e},addCommonParam:function(s,e){return $.extend(s,_.pick(e,"passport","token","plat","uid","sver","valid","starfrom")),s},uploadImg:function(s,e,t,n){var i={status:600,message:a[600],data:null};void 0===e||null===e?i={status:604,message:a[604],data:null}:void 0===s||$.isUndefined(s.files)?t(rst):$.each(s.files,function(s,u){var d=$.extend({},i,{index:s}),m=u.name,r=m.split("."),l=r.length>1?r[r.length-1]:"";l=l.toLowerCase();var g=new FileReader;g.onload=function(s){var i=s.target.result;if($.isUndefined(i.type)||0!==i.type.indexOf("image")||$.isUndefined(i.type)){if(["png","jpg","jpeg","gif",""].indexOf(l)>-1){var u={};u=o.addCommonParam(u,e),u.file=s.target.result,u.name=m,o.uploadImageByAjax(u,function(s){console.log("上传图片:",s);var e=o.uploadImageProcess(s);e.result?(d.status=200,d.message="上传成功!",d.data=e,t(d)):(d.status=603,d.message=e.msg,t(d))},n)}else d.status=602,d.message=a[602],t(d)}else d.status=601,d.message=a[601],t(d)},g.readAsDataURL(u)})}};module.exports={uploadImg:o.uploadImg}});
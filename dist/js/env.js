/*
Change by PengWu on 2017-07-06 19:21:36
*/
svp.define("env",function(require,exports,module){"use strict";function e(e){function t(t){t=t||{},e&&e(t)}if(b.IsSohuVideoClient)try{if(b.IsAndroid)try{console.log("handler.appCallback"),handler&&handler.appCallback&&handler.appCallback(3,1,"{}")}catch(e){}else if(b.IsIOS)var o=setTimeout(function(){console.log("js://jsLoadFinish"),window.location.href="js://jsLoadFinish",clearTimeout(o)},200);var n=setTimeout(function(){v.getUserData(function(t){e&&e(t)}),clearTimeout(n)},400)}catch(e){t()}else t()}function t(e,t,o){var n=w.makeActionUrl({action:"1.18",urls:e||window.location.href,ex1:2,share:void 0==t?"1":t,open:void 0==o?"0":o,more:{sourcedata:{params:"uid&passport&plat&token&clientVer&clientType"}}}),i={action:"2.6",more:{sourcedata:{loginFrom:17,callbackAction:n,closeWebView:1}}};w.sendAction(i)}function o(e,o,i,a,r,s){if(a=a||location.href,b.IsSohuVideoClient)e?i?i():o&&o():t(a,r,s);else{S.get("ppinf")?o&&o():window.location.href=n("//fans.tv.sohu.com/h5/vstar/login.html",{ref:a})}}function n(e,t){if(t=$.param(t||{})){var o="",n=e.indexOf("#");n>-1&&(o=e.substring(n),e=e.substring(0,n)),e=e+(e.indexOf("?")>-1?"&":"?")+t+o}return e}function i(e){var t=_.pick(e,"passport","token","plat","uid","sver");return t.valid=b.IsSohuVideoClient?0:1,t.starfrom=2,t}function a(e){return e&&(e=$.trim(e),e=e.replace(/^http(s)*:\/\//i,b.PROTOCOL),e=e.replace(/^\/\//i,b.PROTOCOL)),e}function r(){if(b.IsSohuVideoClient){var e={action:"1.18",urls:T,ex1:2,share:1,open:"1",more:{sourcedata:{params:"uid&passport&plat&token&clientVer&clientType&gid"}}};location.href=w.makeActionUrl(e)}else location.href=k}function s(e,t,o){var n=e;n.page=1;$.ajax({url:"//api.tv.sohu.com/star/h5/fans/personal/info.do",data:n,dataType:"jsonp",success:function(e){if(200==e.status&&e.message){e.message.isbind?o?location.href=o:t&&t():r()}},error:function(e){console.log(e)}})}function c(e){if(e){var t,o;if(document.title=e,b.IsSohuVideoClient&&b.IsIOS)t=document.createElement("iframe"),t.style.display="none",o=document.body,t.src="js://updateTitle?title="+encodeURIComponent(e),o.appendChild(t),setTimeout(function(){o.removeChild(t)},2e3);else if(b.IsSohuVideoClient&&b.IsAndroid)try{handler.appCallback(4,1,'{"title":"'+e+'"}')}catch(e){}}}function l(t,o,n){function i(e){var t=e.passport.indexOf("@wechat.sohu.com")>-1,i=e.passport.indexOf("@qq.sohu.com")>-1,a=e.passport.indexOf("@sina.sohu.com")>-1;t||i||a?o():s(e,o,n)}var a=S.get("ppinf");o="function"==typeof o?o:function(){},b.IsSohuVideoClient?e(function(e){""!==e.passport&&""!==e.token?i(e):u()}):!a||a.length<5?u():s(t,o,n)}function u(){var o=window.location.href;b.IsSohuVideoClient?t():e(function(){location.href=b.PROTOCOL+"fans.tv.sohu.com/h5/vstar/login.html?ref="+encodeURIComponent(o)})}function f(e,t){var o=t+"失败，请稍后重试!",n=!1;if(void 0!==e){var i=e.status;200===i?(n=!0,o=t+"成功!"):101===i?o="为了更有效的保障您账号安全，请立即绑定手机号!":117===i?o="未登录":10001===i?o="帖子不存在!":10002===i?o="回帖不存在!":10003===i?o="父评论不存在!":10004===i?o="回帖评论不存在!":10005===i?o=t+"失败! 请先关注该出品人，才能发表帖子!":10006===i?o="该出品人不存在!":10007===i?o="帖子已经点赞过了!":10008===i?o="回贴已经点赞过了!":10009===i?o="用户不存在!":10010===i?o="不支持的图片类型!":10011===i?o="无效的图片!":10012===i?o="不支持的附件类型!":10013===i?o="不支持的禁言天数!":10017===i?o="您已被禁言，不能发布内容!":10018===i?o="没有操作权限!":10019===i?o="超过置顶帖子最大数量!":10021===i?o="标题不能为空!":10022===i?o="内容不能为空!":10023===i&&(o="实名制验证失败，请绑定手机号!")}return{msg:o,result:n}}function p(e){var t=e.match(/[^\x00-\xff]/gi);return e.length+(null==t?0:t.length)}function d(e){var t=0;if(document.selection){e.focus();var o=document.selection.createRange();o.moveStart("character",-e.value.length),t=o.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function h(e,t,o){if(e.setSelectionRange)e.setSelectionRange(t,o),e.focus();else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",o),n.moveStart("character",t),n.select()}}function m(e,t){try{t=t||new Date;var o=new Date(e),n=o.getFullYear(),i=o.getMonth()+1,a=o.getDate(),r=t.getTime()-o.getTime();console.log(r);var s=Math.floor(r/31536e6),c=Math.floor(r/864e5),l=r%864e5,u=Math.floor(l/36e5),f=l%36e5,p=Math.floor(f/6e4),d=f%6e4,h=Math.round(d/1e3);return i.toString().length<2&&(i="0"+i),a.toString().length<2&&(a="0"+a),s>0?n+"-"+i+"-"+a:s<=0&&c>3?i+"-"+a:c>=2&&c<=3?"2天前":c>=1&&c<2?"1天前":u<24&&u>=1?u+"小时前":u<1&&p>=1?p+"分钟前":p<1&&h>=0?h+"秒前":"1秒前"}catch(e){}}function g(e){var t=e,o={};return o.clientVer=I.clientVer||t.sver||"",o.uid=I.uid||t.uid||"",o.passport=t.passport||I.passport||"",o.token=I.token||t.token||"",o.plat=I.plat||t.plat||"6",o.poid=t.poid||"1",o.sver=t.sver||"",o.sysver=t.sysVer||"0",o.partner=t.partner||"1",o.mobile=t.mobile||window.SohuAppUserData.mobile||"",o.api_key=b.API_KEY||"72761a5115b39df171d6150d2dba2240",o.gid=I.gid||t.gid||"",o}var v=require("svaUserInfo"),b=require("base/vars"),C=require("base/url"),S=require("base/cookie"),w=require("base/action"),I=(require("base/localStorage"),C.getQueryData(location.search)),T=b.PROTOCOL+"m.tv.sohu.com/upload/clientapp/personal/bind.html",k="//passport.sohu.com/security/bind_mobile";window.pmallPvExt={},function(){$(window).bind("pageshow",function(e){e.persisted&&window.location.reload()})}(),$.fn.scrollBottom=function(){var e=$(this).scrollHeight();$(this).scrollTop(e)},module.exports={getAppUser:e,getCommonParams:i,fixImgHttp:a,setPageTitle:c,isBind:s,indentifyCheck:l,responseDataProcess:f,checkLogin:o,getStrLength:p,pullBindMobilePage:r,getCursortPosition:d,initUserInfo:g,setCaretPosition:h,formatTime:m}});